<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <h2>Help us get to know you!</h2>
        <hr />
        <h4>Name</h4>
        <input id="name" class="form-control" type="text" required="">
        <h4>Link to picture</h4>
        <input id="picture" class="form-control" type="text" required="">
        <hr />

        <h3>Question 1</h3>
        <h4>Your mind is always buzzing with unexplored ideas and plans.</h4>
        <select id="q1" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 2</h3>
        <h4>Generally speaking, you rely more on your experience than your imagination.</h4>
        <select id="q2" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 3</h3>
        <h4>You find it easy to stay relaxed and focused even when there is some pressure.</h4>
        <select id="q3" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 4</h3>
        <h4>You rarely do something just out of sheer curiosity.</h4>
        <select id="q4" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 5</h3>
        <h4>People can rarely upset you.</h4>
        <select id="q5" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 6</h3>
        <h4>It is often difficult for you to relate to other people’s feelings.</h4>
        <select id="q6" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 7</h3>
        <h4>In a discussion, truth should be more important than people’s sensitivities.</h4>
        <select id="q7" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 8</h3>
        <h4>You rarely get carried away by fantasies and ideas.</h4>
        <select id="q8" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 9</h3>
        <h4>You think that everyone’s views should be respected regardless of whether they are supported by facts or
            not.</h4>
        <select id="q9" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <h3>Question 10</h3>
        <h4>You feel more energetic after spending time with a group of people.</h4>
        <select id="q10" class="chosen-select">
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
        </select>
        <hr />

        <button id="submit" class="btn btn-primary btn-lg btn-block" type="submit"
            style="margin-bottom: 10px;">Submit</button>

    </div>

    <footer>
        <div class="container">
            <p>
                <a href="/api/users">API Users data</a>
            </p>
        </div>
    </footer>

    <div class="modal fade" id="match-modal">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title animated fadeInRight faster">Best Match</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body animated zoomIn faster">
                    <h3 id="name-display"></h3>
                    <img id="photo-display" />
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript">
        $("#submit").on("click", function () {

            const newUser = {
                name: $("#name").val().trim(),
                photo: $("#picture").val().trim(),
                answers: [parseInt($("#q1").val()), parseInt($("#q2").val()), parseInt($("#q3").val()),
                    parseInt($("#q4").val()), parseInt($("#q5").val()), parseInt($("#q6").val()),
                    parseInt($("#q7").val()), parseInt($("#q8").val()), parseInt($("#q9").val()),
                    parseInt($("#q10").val())
                ]
            }

            $.post("/api/users", newUser).then(function (data) {
                console.log("added")
                findMatch(newUser)
            })
        })

        function modalDisplay(bestMatch) {

            //findMatch();

            $(".modal-body").html(`
                <h3 id="name-display">${bestMatch.name}</h3>
                <img id="photo-display" src="${bestMatch.photo}" width="250" height="350"/>`);
            $("#match-modal").modal("toggle", {
                keyboard: true
            });
        }

        function findMatch(currentUser) {

            $.get("/api/users").then(function (data) {
                const friends = data;

                let score;

                const scores = []

                friends.forEach(function (friend) {

                    if (friend.name != currentUser.name && friend.photo != currentUser.photo) {
                        for (let i = 0; i < currentUser.answers.length; i++) {

                            score = Math.abs(parseInt(currentUser.answers[i] - friend.answers[i]));

                        }
                    }

                    scores.push(score);
                    console.log(score)

                });

                let min = 100000;

                scores.forEach(function (element) {

                    if (element < min) {
                        min = element;
                    }
                })

                modalDisplay(friends[scores.indexOf(min)])

            })

        }
    </script>
</body>

</html>